/**
 * Issue Modal Complete Styles - Unified & Optimized
 * 
 * Consolidated from:
 * - mobile-issue-modal-unified.css (mobile full-screen container)
 * - issue-modal-header-fix.css (header layout, title, buttons)
 * 
 * Z-index system managed separately by modal-z-index-fix.css
 * 
 * Structure:
 * 1. Desktop & Global Styles (all screen sizes)
 * 2. Mobile Styles (0-768px)
 * 3. Tablet Styles (641px-1024px)
 * 4. Accessibility & Performance
 */

/* ================================================
   DESKTOP & GLOBAL STYLES
   ================================================ */

/* Modal Content Container - Ensure close button not clipped */
.issue-modal [data-slot="dialog-content"] {
  overflow: visible !important; /* Allow close button to be visible */
  position: relative !important; /* Needed for absolute positioning of close button */
}

/* Modal Header Container - Proper spacing for buttons */
.issue-modal [data-slot="dialog-header"] {
  position: relative !important;
  z-index: 1 !important;
  padding-right: 4rem !important; /* Space for close button - CRITICAL */
}

/* Ensure title row doesn't overlap with Close button */
.issue-modal [data-slot="dialog-header"] .space-y-3 {
  position: relative !important;
  z-index: 2 !important; /* Below close button but above background */
}

/* Modal Close Button - Always top-right corner - CRITICAL FIX */
.issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"],
.issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) {
  position: absolute !important;
  top: 1rem !important; /* Adjusted for better visibility */
  right: 1rem !important; /* Adjusted for better visibility */
  z-index: 200 !important; /* Much higher z-index to stay above everything */
  width: 2.5rem !important;
  height: 2.5rem !important;
  padding: 0.5rem !important;
  background: var(--background) !important;
  border: 1px solid var(--border) !important;
  border-radius: 0.375rem !important;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  pointer-events: auto !important; /* Ensure clickable */
  cursor: pointer !important; /* Ensure cursor changes */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  opacity: 1 !important; /* Always fully visible */
  visibility: visible !important; /* Force visibility */
  color: var(--foreground) !important; /* Ensure icon visible */
}

/* Close button X icon */
.issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"] svg,
.issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) svg {
  width: 1.25rem !important;
  height: 1.25rem !important;
  color: currentColor !important;
}

.issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"]:hover,
.issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only):hover {
  background: var(--muted) !important;
  border-color: var(--primary) !important;
  transform: scale(1.05) !important;
  opacity: 1 !important;
}

.dark .issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"],
.dark .issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) {
  background: hsl(var(--card)) !important;
  border-color: hsl(var(--border)) !important;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3) !important;
  color: hsl(var(--foreground)) !important;
}

/* Header Layout - Flex with proper spacing */
.issue-modal
  [data-slot="dialog-header"]
  .space-y-3
  > .flex.items-start {
  display: flex !important;
  align-items: flex-start !important;
  justify-content: space-between !important;
  gap: 1rem !important;
  width: 100% !important;
}

/* Title - Allow proper wrapping */
.issue-modal
  [data-slot="dialog-header"]
  .space-y-3
  > .flex.items-start
  > h2 {
  flex: 1 1 auto !important;
  min-width: 0 !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important;
  padding-right: 1rem !important;
  line-height: 1.3 !important;
}

/* Tablet and Desktop - Constrain title width to prevent button overlap */
@media (min-width: 769px) {
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > h2 {
    max-width: 65% !important;
  }
}

@media (min-width: 1280px) {
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > h2 {
    max-width: 70% !important;
  }
}

@media (min-width: 1536px) {
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > h2 {
    max-width: 75% !important;
  }
}

/* Action Buttons Container - Proper alignment */
.issue-modal
  [data-slot="dialog-header"]
  .space-y-3
  > .flex.items-start
  > .flex-shrink-0 {
  flex-shrink: 0 !important;
  display: flex !important;
  align-items: flex-start !important;
  gap: 0.5rem !important;
  margin-top: 0 !important;
  align-self: flex-start !important;
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
}

.issue-modal
  [data-slot="dialog-header"]
  .space-y-3
  > .flex.items-start
  > .flex-shrink-0
  > * {
  white-space: nowrap !important;
  flex-shrink: 0 !important;
}

/* Fallback for narrow screens on desktop */
@media (min-width: 769px) and (max-width: 900px) {
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > .flex-shrink-0 {
    flex-wrap: wrap !important;
  }
}

/* Prevent button text from wrapping */
.issue-modal [data-slot="dialog-header"] button {
  white-space: nowrap !important;
}

/* Hover states for action buttons (exclude close button) */
.issue-modal [data-slot="dialog-header"] button:not([data-slot="dialog-close"]):not(:has(> span.sr-only)):hover {
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

/* Approve button specific styling */
.issue-modal [data-slot="dialog-header"] button.bg-green-600 {
  box-shadow: 0 2px 8px rgba(22, 163, 74, 0.3) !important;
}

.issue-modal
  [data-slot="dialog-header"]
  button.bg-green-600:hover {
  box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4) !important;
}

/* Request Changes button hover */
.issue-modal
  [data-slot="dialog-header"]
  button.hover\\:bg-orange-50:hover {
  background: rgba(251, 146, 60, 0.1) !important;
  border-color: rgba(251, 146, 60, 0.3) !important;
}

/* Dark mode adjustments */
.dark
  .issue-modal
  [data-slot="dialog-header"]
  button.bg-green-600 {
  background: #16a34a !important;
}

.dark
  .issue-modal
  [data-slot="dialog-header"]
  button.bg-green-600:hover {
  background: #15803d !important;
}

/* Prevent layout shift when buttons appear/disappear */
.issue-modal
  [data-slot="dialog-header"]
  .space-y-3
  > .flex.items-start
  > .flex-shrink-0 {
  min-height: 2.25rem !important;
}

/* ================================================
   MOBILE STYLES (0-768px)
   ================================================ */

@media (max-width: 768px) {
  
  /* ========================================
     MODAL CONTAINER - FULL SCREEN
     ======================================== */
  
  [data-slot="dialog-content"].issue-modal {
    /* Full viewport coverage */
    max-width: 100vw !important;
    max-height: 100vh !important;
    width: 100vw !important;
    height: 100vh !important;
    
    /* Position fixed for full screen */
    position: fixed !important;
    
    /* Reset transforms and spacing */
    margin: 0 !important;
    padding: 0 !important;
    transform: none !important;
    border-radius: 0 !important;
    border: none !important;
    
    /* Flex layout for sticky header/footer */
    display: flex !important;
    flex-direction: column !important;
    
    /* iOS safe areas */
    padding-top: env(safe-area-inset-top) !important;
    padding-bottom: env(safe-area-inset-bottom) !important;
    
    /* Slide up animation */
    animation: slide-up-mobile 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  }
  
  @keyframes slide-up-mobile {
    from {
      transform: translateY(100%) !important;
      opacity: 0 !important;
    }
    to {
      transform: translateY(0) !important;
      opacity: 1 !important;
    }
  }
  
  /* Overlay - Proper stacking */
  .issue-modal [data-slot="dialog-overlay"] {
    position: fixed !important;
    inset: 0 !important;
  }
  
  /* ========================================
     HEADER - STICKY WITH UX OPTIMIZATIONS
     ======================================== */
  
  .issue-modal [data-slot="dialog-header"] {
    /* Sticky positioning */
    position: sticky !important;
    top: 0 !important;
    z-index: 10 !important;
    flex-shrink: 0 !important;
    overflow: visible !important;
    
    /* Visual polish */
    backdrop-filter: blur(8px) !important;
    background: var(--background) !important;
    border-bottom: 1px solid hsl(var(--border) / 0.4) !important;
    
    /* Compact padding with safe areas */
    padding: 1rem !important;
    padding-bottom: 0.875rem !important;
    padding-top: max(1rem, env(safe-area-inset-top)) !important;
    
    /* Performance */
    contain: layout style !important;
  }
  
  /* Header with scroll shadow */
  .issue-modal [data-slot="dialog-header"].scrolled {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  }
  
  .dark .issue-modal [data-slot="dialog-header"] {
    background: rgba(10, 10, 10, 0.95) !important;
    border-bottom-color: hsl(var(--border) / 0.3) !important;
  }
  
  .dark .issue-modal [data-slot="dialog-header"].scrolled {
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3) !important;
  }

  /* Title + buttons container - Stack on mobile */
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 0.75rem !important;
  }

  /* Title - Full width on mobile */
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > h2 {
    width: 100% !important;
    max-width: 100% !important; /* Override desktop constraint */
    padding-right: 0 !important;
    margin-bottom: 0.5rem !important;
  }

  /* Action buttons - Full width row on mobile */
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > .flex-shrink-0 {
    width: 100% !important;
    justify-content: flex-start !important;
    flex-wrap: wrap !important;
    min-height: auto !important;
  }

  /* Compact buttons on mobile (exclude close button) */
  .issue-modal [data-slot="dialog-header"] button:not([data-slot="dialog-close"]):not(:has(> span.sr-only)) {
    height: 2.25rem !important;
    padding: 0 0.75rem !important;
    font-size: 0.8125rem !important;
  }

  .issue-modal [data-slot="dialog-header"] button:not([data-slot="dialog-close"]):not(:has(> span.sr-only)) svg {
    width: 1rem !important;
    height: 1rem !important;
  }

  /* Badge sizing on mobile */
  .issue-modal [data-slot="dialog-header"] [data-slot="badge"] {
    font-size: 0.75rem !important;
    padding: 0.25rem 0.5rem !important;
  }

  /* Close button - Even smaller */
  .issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"],
  .issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) {
    top: 0.5rem !important;
    right: 0.5rem !important;
    width: 2rem !important;
    height: 2rem !important;
    padding: 0.375rem !important;
  }
  
  /* ========================================
     BREADCRUMB - ULTRA COMPACT
     ======================================== */
  
  /* Breadcrumb container - avoid close button */
  .issue-modal [data-slot="dialog-header"] .mb-4 {
    margin-bottom: 0.75rem !important;
    padding-right: 2.5rem !important;
  }

  .issue-modal .sub-issue-breadcrumb {
    margin-bottom: 0.625rem !important;
    gap: 0.5rem !important;
  }
  
  .issue-modal .back-to-parent-btn {
    height: 1.75rem !important;
    padding: 0 0.25rem !important;
    font-size: 0.813rem !important;
    color: hsl(var(--muted-foreground)) !important;
  }

  .issue-modal
    [data-slot="dialog-header"]
    .flex.items-center.gap-2 {
    flex-wrap: wrap !important;
    gap: 0.5rem !important;
  }

  .issue-modal
    [data-slot="dialog-header"]
    .text-xs.font-medium {
    font-size: 0.6875rem !important;
  }
}

/* Extra small screens (< 375px) */
@media (max-width: 374px) {
  .issue-modal [data-slot="dialog-header"] {
    padding: 0.75rem !important;
    padding-right: 3rem !important;
  }

  /* Stack action buttons vertically on very small screens */
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > .flex-shrink-0 {
    flex-direction: column !important;
    align-items: stretch !important;
  }

  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > .flex-shrink-0
    button {
    width: 100% !important;
    justify-content: center !important;
  }

  /* Close button - Even smaller */
  .issue-modal button[aria-label="Close"] {
    top: 0.5rem !important;
    right: 0.5rem !important;
    width: 2rem !important;
    height: 2rem !important;
    padding: 0.375rem !important;
  }
}

/* ================================================
   TABLET LAYOUT (641px - 1024px)
   ================================================ */

@media (min-width: 641px) and (max-width: 1024px) {
  .issue-modal [data-slot="dialog-header"] {
    padding: 1.25rem !important;
    padding-right: 4rem !important;
  }

  /* Horizontal layout maintained on tablet */
  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start {
    flex-direction: row !important;
    align-items: flex-start !important;
  }

  .issue-modal
    [data-slot="dialog-header"]
    .space-y-3
    > .flex.items-start
    > h2 {
    padding-right: 1rem !important;
  }
}

/* ================================================
   ACCESSIBILITY & PERFORMANCE
   ================================================ */

/* Focus states for accessibility */
.issue-modal [data-slot="dialog-header"] button:focus-visible {
  outline: 2px solid var(--primary) !important;
  outline-offset: 2px !important;
}

/* Loading state for buttons */
.issue-modal [data-slot="dialog-header"] button[disabled] {
  opacity: 0.5 !important;
  cursor: not-allowed !important;
  transform: none !important;
}

/* Badge wrapping on mobile */
@media (max-width: 640px) {
  .issue-modal
    [data-slot="dialog-header"]
    .flex.items-center.gap-2.flex-wrap {
    gap: 0.375rem !important;
  }
}

/* Smooth transitions */
.issue-modal [data-slot="dialog-header"] button,
.issue-modal [data-slot="dialog-header"] [data-slot="badge"] {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"],
  .issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) {
    border-width: 2px !important;
  }

  .issue-modal [data-slot="dialog-header"] button {
    border-width: 2px !important;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .issue-modal [data-slot="dialog-header"] button,
  .issue-modal [data-slot="dialog-header"] [data-slot="badge"],
  .issue-modal [data-slot="dialog-content"] > button[data-slot="dialog-close"],
  .issue-modal [data-slot="dialog-content"] > button:has(> span.sr-only) {
    transition: none !important;
  }
  
  [data-slot="dialog-content"].issue-modal {
    animation: none !important;
  }
}